Changelog of flooding-lib
===================================================

2.5.1 (2012-08-15)
------------------

Fix bug where a scenario's status wasn't updated after it was
approved.


2.5 (2012-08-15)
----------------

Decided that dates will always be saved in YYYY-MM-DD where they have
to be stored as strings. Changed importool.DateValue to reflect that.

Improved error checking of Excel import/export.

Improved Excel formatting of dates and numbers.

2.4.2 (2012-08-14)
------------------

Another crash in import: lazy translations of model choices sometimes
need explicit unicode() calls.


2.4.1 (2012-08-14)
------------------

Importing a new scenario relied on a specific ApprovalObjectType id to
exist (1), which doesn't on production. Instead it should use
default_approval_type() class method that was already made for this
exact purpose...


2.4 (2012-08-14)
----------------

Don't show deleted scenarios on the scenario sharing screen.

More work on the Excel export/import. Imported Excel files are now
actually saved in the database. This is still a work in progress.

Fix a bug that prevents Javascript displaying the 'import new
scenario' page (doubly-escaped Javascript).

Some cleanup, more tests, more translated strings.

2.3 (2012-08-09)
----------------

More information about scenarios when offering / accepting them.

Only allow Approved scenarios to be offered.

Fixed display of intervals.

Fixed a few internal server errors where a lazy translation was
immediately returned as a HttpResponse (need to call unicode() on them
first).


2.2.4 (2012-07-31)
------------------

Forgot to add a file...


2.2.3 (2012-07-31)
------------------

Split the scenario sharing screen into a table of projects and a
screen per project, for speed.


2.2.2 (2012-07-31)
------------------

Fix bug in showing the value of a Select field (Variable didn't
exist. Should have made a test in the first place.)


2.2.1 (2012-07-31)
------------------

A few tests weren't updated yet to the latest versions of some methods.


2.2 (2012-07-31)
----------------

Work on Excel import/export.

Started styling data cells in the Excel file (turned wrap on). To do: styling of dates.

Only InputFields relating directly to the current scenario (Scenario,
ScenarioBreach, ExtraScenarioInfo) will be imported. Other fields
(e.g. from Project) will be shown with gray headers for reference in
the Excel file, but ignored by the import.

Screens from exporting and importing Excel screens have been further improved.

Work on getting the fiels to show right in Excel, and then be parsed
correctly afterwards.  Actually entering the imported values into the
database at the end is not implemented yet, nor is checking of
permissions.

Because we are doing a release today, the link in the importtool page to these
exports is disabled.

2.1 (2012-07-26)
----------------

Fixes problems with translating fields from importtool classes (fix:
use ugettext_lazy instead of ugettext, call unicode() in some places).

Adds 'original_scenarios' method to models.Project.

Stops using eval() to parse the "options" part of an InputField;
ast.literal_eval() is safer.

Exporting Excel files mostly works:
    The Excel file format is modelled after the existing format that is
    used by the importtool, and its example Excel files.

    There is a header (the first four rows of the file) and after that,
    one row per scenario in the file.

    In the header, the leftmost column is empty. Then, there is a column
    for each inputfield of the importtool. These are group by header, as
    in the importtool.

    Row 1 holds the name of the header (this will be repeated through
    several columns)

    Row 2 holds the name of the field

    Row 3 holds the type of the field

    Row 4 holds the 'Excel hint' of the field.

    Required fields will have all their text in bold. A field is required
    if it has a "hint_text" containing *, ** or ***. This includes fields
    that don't have "required == True". The reason is that this Excel
    output/input functionality is right now only for updating old data,
    and old data only contains "type 1" scenarios.

    For each row after the header, column 1 will contain the scenario's
    primary key ID field, and the other columns will have the scenario's
    existing data for the field in that column, if any.

    There will be one Excel file per project, and it will contain all the
    scenarios for which that project is the main project. If there are no
    such scenarios, there won't be an Excel file.

See flooding_lib.excel_import_export.py and the excel_files_for_all_projects
management command.

Getting a value out of a scenario using an inputfield (for the infowindow and for
Excel files) is now in Scenario.value_for_inputfield(). Turning a value into a
displayable string is in InputField.display_unicode(value).

Added a simple view for exporting Excel files.

2.0.4 (2012-07-23)
------------------

We check the names of headers in the information infowindow to see if
extra fields should be added there, but depending on the system, the
names are translated or not. Current hackish fix is to test for both.

2.0.3 (2012-07-23)
------------------

- Nothing changed yet.


2.0.2 (2012-07-23)
------------------

Made value_string() fit for use with Unicode-containing strings, and
renamed it to value_unicode().


2.0.1 (2012-07-20)
------------------

Fix a bug where anonymous users couldn't see the regions they are
allowed to see.

Restore the tide waterlevel graph to the scenario information
infowindow.

2.1 (unreleased)
----------------

Overhaul of the approval system. From now on, there will be no
Task-based approval, nor any project-wide 'approved' checkbox. The only
thing we will use is the approval objects from approvaltool, and their
contents will be changed.

Steps taken:
- A large migration removes all the existing approval objects, creates
  a new approval type with one rule ('is this project approved?') and
  for each scenario, connects this approval type to it. The successful
  property of the rule is set based on the old Task-based status.

- Made 'type' in approvaltool.ApprovalObjectType unique. This is the
  identifier we shall be using that relates projects' default approval
  types to database rows in this table.

- Each project now has a field 'approval_object_type' that defines which
  approval object type scenarios in it will use. All existing projects use
  the default one (hand edit ROR and Landelijk gebied when this change
  goes live).

- Scenario.approval_object() method creates the approval object if it
  doesn't exist yet, using the project's default.

- Scenario.main_approval_object() method that does the same but only for
  the main project.

- Add helper functions to ApprovalObject: setup() to create a new
  approvalobject that also enters ApprovalObjectState lines into the
  database, and approved() and disapproved() properties that check
  whether all or some of the states have been filled in.

- Change Scenario.update_status() so that it looks at the approval object
  of the main project for approved and disapproved status. Tasks for
  approval and disapproval are now obsolete.

- Removed the old UI for task-based approval

- Added a ApprovalObjectLog model that logs the history of a certain
  approvalobject/rule combination, ApprovalObjectState doesn't do that
  anymore

Improved the scenario sharing pages.

Approvers of scenarios that they have offered to other projects can
now see the status of their scenarios' approvals in those other
projects.

If a scenario is now approved on some rules and not yet judged on
others (their value is null), it is now neither approved nor
disapproved. Used to be disapproved in this situation. A scenario is
disapproved if its success value is False for at least one of the
rules.

Improved the translations somewhat.

2.0 (2012-07-09)
----------------

"Het kan wel eens 2.0 worden"
  -- Martijn Siemerink, 2012


Solved issue Trac #3684

  After an individual scenario upload, the user can optionally upload
  files.  After uploading, the site used to redirect immediately to
  the import overview screen, but now it redirects to a tiny screen
  with a success message and a link to the overview screen.

Solved issue Trac #3711

  In the export CSV view (flooding_lib.views.scenario_list), ASCII
  strings were used in combination with user-defined data. This led to
  Unicode decoding errors. Working with Unicode only solves the
  problem.

  Instead of writing a CSV file to disk and then reading it back in to
  send it to the browser, we just send it there directly.

  Added a util/csvutil.py to work with Unicode CSV files.

  CSV file generation may well hit timeout limits, depends on the
  query parameters.

1.39 (2012-07-06)
-----------------

We are testing and fixed the following issues:

- Restored a scenario.project_id field for the benefit of the old uitvoerder.py scripts

- Forgot to set field.value_str instead of field.value for the
  scenario ID that we hack into the info window by hand

- 999 was also sometimes used as a sentinel, just like -999. Ignore it too.

- Changed another .project to .main_project

- We should really use Unicode everywhere, people use non-ASCII
  characters and there's no reason why we should crash on them

- Added an 'ignore' directory to .gitignore, helpful to put silly
  temporary files in


1.38.1 (2012-07-06)
-------------------

- Fixed two occurences of 'scenario.project' that should be
  'scenario.main_project' now.


1.38 (2012-07-06)
-----------------

- Solved issues from Trac #3682. In the scenario info window:
  - Coordinates are shown in RD, not WGS84
  - Intervals are shown as '2 d 12:00', not as 2.5
  - Values like '-999' are treated as null values

1.37 (2012-07-02)
-----------------

- Fix issues relating to #3705; obviously import wasn't tested yet and
  there were several typos and things that couldn't work. Works on my
  development machine now.


1.36 (2012-07-02)
-----------------

- Changed scenario fields to null=True to make testing easier

- Added ScenarioProject model

- Changed most of them to new, tested functions

- Changed scenario fields to null=True to make testing easier

- Added 'color_mapping_name' field to 'Project' model (the field
  exists yet, fake it on migration).


1.35 (2012-06-26)
-----------------

- Add breadcrumbs to add files screen in import (#3687)

- Make WAITING the default state for new ImportScenarios (#3685)

- Large scale code formatting (pep8/pyflakes), down to 0 errors from
  ~2300

- Refactor and test import code some more (move functionality from
  views into models)

- Fixed import of Image.

- Added tests for get_scenarios() in UserPermissionManager, test
  multiple projects per scenario

- Got tests to work -- multiple projects per scenario is functional
  now

1.34 (2012-06-20)
-----------------

- Changed the scenario information window. It now:
  - Shows all the headers and fields from the import new scenario screen
  - Adds scenario id, attachments
  To do:
  - some nice things of the old version should be included, like the graph
  - some things have unexpected 'missing' values (like 999) and we don't
    filter for them yet

1.33 (2012-06-15)
-----------------

- Add south migrations for all the apps.


1.32.2 (2012-06-15)
-------------------

- Nothing changed yet.


1.32.1 (2012-06-15)
-------------------

- Nothing changed yet.


1.32 (2012-06-15)
-----------------

- Fix bug with importing Excel dates #3683.


1.31.1 (2012-06-14)
-------------------

- Fix issue with encoding the legend Text.


1.30 (2012-06-14)
-----------------

- Show a legend text above the import new scenario screen.

- Increased flooding-base to 1.24 so we can use its Text model

- Continued refactoring, testing of importtool

- Ticket #3679, adds a legend Text to the new scenario screen.
  Uses a Text from the database with slug 'importnewscenario'.

1.29 (2012-06-12)
-----------------

- Renamed lizard_presentation to flooding_presentation.

- Renamed lizard_visualization to flooding_visualization.

1.28.3 (2012-06-11)
-------------------

- Nothing changed yet.


1.28.2 (2012-06-11)
-------------------

- Now using flooding-worker instead of lizard-flooding-worker.


1.28.1 (2012-06-11)
-------------------

- Nothing changed yet.


1.28 (2012-06-11)
-----------------

- RENAMED lizard-flooding TO flooding_lib

- Moved stuff to Github

- Got tests etc to work


1.27 (2012-05-16)
-----------------

- Nothing changed yet.


1.26 (2012-05-16)
-----------------

- Nothing changed yet.


1.25 (2012-05-10)
-----------------

- Made a field check case insensitive.


1.24 (2012-05-10)
-----------------

- Added extra extra info field headers.


1.23 (2012-05-04)
-----------------

- Nothing changed yet.


1.22 (2012-05-04)
-----------------

- Nothing changed yet.


1.21 (2012-05-04)
-----------------

- Fixed that download view...


1.20 (2012-05-03)
-----------------

- 'Export' button leads to a page with download results for the entire scenario.

- Download file view uses Nginx accelerated redirect to serve the files.


1.19 (2012-04-24)
-----------------

- Nothing changed yet.


1.18 (2012-03-27)
-----------------

- Fixed database settings in services.py.


1.17 (2012-03-07)
-----------------

- Nothing changed yet.


1.16 (2012-03-01)
-----------------

- Nothing changed yet.


1.15 (2012-03-01)
-----------------

- performance improvement for compose form

- made link for linux to resultaten database (bug fix load import)

- create a link to the symbols for visualization (bug fix for channel results)



1.14 (2012-02-29)
-----------------

- Did a release because flooding's buildout is modernized too.
- Slightly modernized buildout (sysegg for GDAL).
- Added workflow_template field to Scenario model.
- Added 'lizard_flooding_task' app.
- Moved tasks dir to 'lizard_flooding_app'.
- Moved 'perform_task' management command to 'lizard_flooding_worker'.


1.13 (2011-05-25)
-----------------

- Nothing changed yet.


1.12 (2011-05-06)
-----------------

- Nothing changed yet.


1.11 (2011-05-06)
-----------------

- Nothing changed yet.


1.10 (2011-04-18)
-----------------

- Nothing changed yet.


1.9 (2011-03-25)
----------------

- Nothing changed yet.


1.8 (2011-03-23)
----------------

- Nothing changed yet.


1.7 (2011-03-03)
----------------

- Nothing changed yet.


1.6 (2011-02-08)
----------------

- Nothing changed yet.


1.5 (2011-02-08)
----------------

- Nothing changed yet.


1.4 (2011-02-07)
----------------

- Nothing changed yet.


1.3 (2011-02-01)
----------------

- Nothing changed yet.


1.2 (2011-01-20)
----------------

- Nothing changed yet.


1.1 (2010-04-23)
----------------

- Making PNG result images working on linux, too.


1.0 (2010-04-21)
----------------

- Added "old" flooding as lizard_flooding.

- Also added "old" visualization and presentation into this very same python
  package as lizard_visualization and lizard_presentation.  WARNING: there are
  now three django apps in one python package.  Necessary as the code was
  pretty much intertwined.

- Initial library skeleton created by nensskel.
